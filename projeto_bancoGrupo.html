<!DOCTYPE html>
<html lang="pt-BR">
<head>

    <!--COMENTARIO PARA TESTE DO GIT-->

    <!--EXEMPLO DE DIFF COMMIT-->
    <!--EXEMPLO DE DIFF COMMIT-->
    <!--EXEMPLO DE DIFF COMMIT-->
    <!--EXEMPLO DE DIFF COMMIT-->
    <!--EXEMPLO DE DIFF COMMIT-->
    <!--EXEMPLO DE DIFF COMMIT-->
    
    <h1>blalvalala</h1>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banco Fict√≠cio</title>
    
    <!-- 
      CSS (Estiliza√ß√£o)
      Todo o CSS est√° embutido neste arquivo HTML.
    -->
    <style>
        :root {
            --cor-primaria: #0056b3;
            --cor-primaria-hover: #004494;
            --cor-secundaria: #f8f9fa;
            --cor-borda: #dee2e6;
            --cor-texto: #212529;
            --cor-texto-claro: #f8f9fa;
            --cor-sucesso: #28a745;
            --cor-erro: #dc3545;
            --cor-aviso: #ffc107;
            --cor-fundo: #f4f7f6;
            --cor-fundo-container: #ffffff;
            --sombra: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--cor-fundo);
            color: var(--cor-texto);
            transition: background-color 0.3s, color 0.3s;
            line-height: 1.6;
        }

        /* --- Modo Escuro --- */
        body.dark-mode {
            --cor-primaria: #007bff;
            --cor-primaria-hover: #0069d9;
            --cor-secundaria: #343a40;
            --cor-borda: #495057;
            --cor-texto: #f8f9fa;
            --cor-fundo: #121212;
            --cor-fundo-container: #1e1e1e;
            --sombra: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* --- Container Principal --- */
        #app-container {
            max-width: 700px;
            margin: 20px auto;
            padding: 2rem;
            background-color: var(--cor-fundo-container);
            border-radius: 12px;
            box-shadow: var(--sombra);
            border: 1px solid var(--cor-borda);
            min-height: 500px;
        }

        /* --- Notifica√ß√µes --- */
        #notification-bar {
            position: fixed;
            top: -100px; /* Come√ßa fora da tela */
            left: 50%;
            transform: translateX(-50%);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: var(--cor-texto-claro);
            font-weight: 500;
            z-index: 1000;
            transition: top 0.4s ease-in-out;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        #notification-bar.show {
            top: 20px;
        }
        #notification-bar.success { background-color: var(--cor-sucesso); }
        #notification-bar.error { background-color: var(--cor-erro); }
        #notification-bar.info { background-color: var(--cor-aviso); color: #333; }

        /* --- Utilit√°rios --- */
        .page {
            display: none; /* Todas as p√°ginas come√ßam ocultas */
            animation: fadeIn 0.5s ease-in-out;
        }
        .page.active {
            display: block; /* A p√°gina ativa √© exibida */
        }
        .hidden {
            display: none;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Cabe√ßalho e T√≠tulos --- */
        header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--cor-primaria);
        }
        header h1 {
            color: var(--cor-primaria);
            margin: 0;
            font-size: 2.5rem;
        }

        h2 {
            color: var(--cor-primaria);
            border-bottom: 1px solid var(--cor-borda);
            padding-bottom: 0.5rem;
            margin-top: 0;
        }

        /* --- Bot√µes --- */
        .btn {
            display: inline-block;
            width: 100%;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            font-weight: 500;
            text-align: center;
            text-decoration: none;
            color: var(--cor-texto-claro);
            background-color: var(--cor-primaria);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            margin-top: 0.5rem;
            box-sizing: border-box; /* Garante que padding n√£o afete a largura */
        }
        .btn:hover {
            background-color: var(--cor-primaria-hover);
            transform: translateY(-2px);
        }
        .btn-secondary {
            background-color: var(--cor-secundaria);
            color: var(--cor-texto);
            border: 1px solid var(--cor-borda);
        }
        .btn-secondary:hover {
            background-color: var(--cor-borda);
        }
        .btn-danger {
            background-color: var(--cor-erro);
        }
        .btn-danger:hover {
            background-color: #c82333;
        }

        /* --- Formul√°rios --- */
        .form-group {
            margin-bottom: 1rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        .form-control {
            width: 100%;
            padding: 0.75rem;
            font-size: 1rem;
            border: 1px solid var(--cor-borda);
            border-radius: 8px;
            background-color: var(--cor-fundo-container);
            color: var(--cor-texto);
            box-sizing: border-box; /* Garante que padding n√£o afete a largura */
        }
        .form-control:focus {
            outline: none;
            border-color: var(--cor-primaria);
            box-shadow: 0 0 0 3px rgba(0, 86, 179, 0.25);
        }
        .form-control::placeholder {
            color: #888;
        }

        /* --- Dashboard --- */
        #dashboard-header {
            background-color: var(--cor-secundaria);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border: 1px solid var(--cor-borda);
        }
        #welcome-message {
            margin-top: 0;
            margin-bottom: 0.5rem;
            font-size: 1.5rem;
            font-weight: 600;
        }
        #dashboard-saldo {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--cor-primaria);
            margin: 0;
        }
        #dashboard-nav {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        /* --- P√°gina de Transa√ß√µes --- */
        #transactions-list {
            list-style: none;
            padding: 0;
            margin: 0;
            max-height: 400px;
            overflow-y: auto;
        }
        #transactions-list li {
            padding: 1rem;
            border-bottom: 1px solid var(--cor-borda);
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        #transactions-list li:last-child {
            border-bottom: none;
        }
        .transacao-info {
            flex-basis: 70%;
        }
        .transacao-valor {
            flex-basis: 30%;
            text-align: right;
            font-weight: 600;
        }
        .transacao-tipo {
            font-weight: 500;
            display: block;
        }
        .transacao-data {
            font-size: 0.85rem;
            color: #777;
        }
        body.dark-mode .transacao-data {
            color: #aaa;
        }
        .valor-positivo {
            color: var(--cor-sucesso);
        }
        .valor-negativo {
            color: var(--cor-erro);
        }

        /* --- P√°gina de Perfil e Configura√ß√µes --- */
        .info-box {
            background-color: var(--cor-secundaria);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--cor-borda);
            margin-bottom: 1rem;
        }
        .info-box p {
            margin: 0.5rem 0;
        }
        .info-box strong {
            color: var(--cor-primaria);
        }

        #config-page {
            border-top: 1px dashed var(--cor-borda);
            margin-top: 2rem;
            padding-top: 1.5rem;
        }

    </style>
</head>
<body>

    <!-- Barra de Notifica√ß√£o -->
    <div id="notification-bar"></div>

    <!-- Container Principal do App -->
    <div id="app-container">
        
        <header>
            <h1>Banco Fict√≠cio</h1>
        </header>

        <main>

            <!-- 
              üè† TELA INICIAL (HOME) 
            -->
            <div id="home-page" class="page">
                <h2>Bem-vindo!</h2>
                <p>Acesse sua conta ou crie uma nova para come√ßar.</p>
                <button id="btn-goto-login" class="btn">Fazer Login</button>
                <button id="btn-goto-create-account" class="btn btn-secondary">Criar Conta</button>
                
                <!-- ‚öôÔ∏è Configura√ß√µes (na tela inicial) -->
                <div id="config-page">
                    <h3>Configura√ß√µes</h3>
                    <button id="btn-toggle-theme" class="btn btn-secondary">Alternar Tema (Claro/Escuro)</button>
                    <button id="btn-clear-data" class="btn btn-danger">Limpar Todos os Dados de Teste</button>
                </div>
            </div>

            <!-- 
              üßæ CRIAR CONTA 
            -->
            <div id="create-account-page" class="page">
                <h2>Criar Nova Conta</h2>
                <form id="create-account-form">
                    <div class="form-group">
                        <label for="create-nome">Nome Completo</label>
                        <input type="text" id="create-nome" class="form-control" placeholder="Seu nome" required>
                    </div>
                    <div class="form-group">
                        <label for="create-cpf">CPF (apenas n√∫meros)</label>
                        <input type="text" id="create-cpf" class="form-control" placeholder="11 d√≠gitos" required maxlength="11" pattern="\d{11}">
                    </div>
                    <div class="form-group">
                        <label for="create-senha">Senha</label>
                        <input type="password" id="create-senha" class="form-control" placeholder="M√≠nimo 4 caracteres" required minlength="4">
                    </div>
                    <div class="form-group">
                        <label for="create-saldo">Saldo Inicial</label>
                        <input type="text" id="create-saldo" class="form-control" value="R$ 0,00" disabled>
                    </div>
                    <button type="submit" class="btn">Confirmar Cria√ß√£o</button>
                    <button type="button" class="btn btn-secondary btn-back-home">Voltar</button>
                </form>
            </div>

            <!-- 
              üîê LOGIN 
            -->
            <div id="login-page" class="page">
                <h2>Login</h2>
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-cpf">CPF (apenas n√∫meros)</label>
                        <input type="text" id="login-cpf" class="form-control" placeholder="11 d√≠gitos" required maxlength="11">
                    </div>
                    <div class="form-group">
                        <label for="login-senha">Senha</label>
                        <input type="password" id="login-senha" class="form-control" placeholder="Sua senha" required>
                    </div>
                    <button type="submit" class="btn">Entrar</button>
                    <button type="button" class="btn btn-secondary btn-back-home">Voltar</button>
                </form>
            </div>

            <!-- 
              üíº DASHBOARD (Tela Principal P√≥s-Login) 
            -->
            <div id="dashboard-page" class="page">
                <div id="dashboard-header">
                    <h2 id="welcome-message">Ol√°, [Nome]!</h2>
                    <p id="dashboard-saldo" title="Seu saldo atual">R$ 0,00</p>
                </div>
                
                <nav id="dashboard-nav">
                    <button id="btn-goto-deposit" class="btn">Depositar</button>
                    <button id="btn-goto-transfer" class="btn">Transferir (Pix)</button>
                    <button id="btn-goto-invest" class="btn">Investir</button>
                    <button id="btn-goto-transactions" class="btn">Ver Hist√≥rico</button>
                    <button id="btn-goto-profile" class="btn btn-secondary">Meu Perfil</button>
                    <button id="btn-logout" class="btn btn-danger">Sair</button>
                </nav>
            </div>

            <!-- 
              üí∞ DEP√ìSITO 
            -->
            <div id="deposit-page" class="page">
                <h2>Depositar</h2>
                <form id="deposit-form">
                    <div class="form-group">
                        <label for="deposit-amount">Valor do Dep√≥sito</label>
                        <input type="number" id="deposit-amount" class="form-control" placeholder="0.00" required min="0.01" step="0.01">
                    </div>
                    <button type="submit" class="btn">Confirmar Dep√≥sito</button>
                    <button type="button" class="btn btn-secondary btn-back-dashboard">Voltar ao Dashboard</button>
                </form>
            </div>

            <!-- 
              üí∏ TRANSFER√äNCIA (PIX) 
            -->
            <div id="transfer-page" class="page">
                <h2>Transferir (Pix)</h2>
                <form id="transfer-form">
                    <div class="form-group">
                        <label for="transfer-cpf">CPF do Destinat√°rio</label>
                        <input type="text" id="transfer-cpf" class="form-control" placeholder="11 d√≠gitos" required maxlength="11">
                    </div>
                    <div class="form-group">
                        <label for="transfer-amount">Valor da Transfer√™ncia</label>
                        <input type="number" id="transfer-amount" class="form-control" placeholder="0.00" required min="0.01" step="0.01">
                    </div>
                    <button type="submit" class="btn">Confirmar Transfer√™ncia</button>
                    <button type="button" class="btn btn-secondary btn-back-dashboard">Voltar ao Dashboard</button>
                </form>
            </div>

            <!-- 
              üìà INVESTIMENTOS 
            -->
            <div id="invest-page" class="page">
                <h2>Investir</h2>
                <form id="invest-form">
                    <div class="form-group">
                        <label for="invest-type">Tipo de Investimento</label>
                        <select id="invest-type" class="form-control">
                            <option value="cdb">CDB (Rendimento fixo 10% a.a)</option>
                            <option value="tesouro">Tesouro (Rendimento fixo 8% a.a)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="invest-amount">Valor a Investir</label>
                        <input type="number" id="invest-amount" class="form-control" placeholder="0.00" required min="1.00" step="0.01">
                    </div>
                    <button type="submit" class="btn">Confirmar Investimento</button>
                    <button type="button" class="btn btn-secondary btn-back-dashboard">Voltar ao Dashboard</button>
                </form>
            </div>

            <!-- 
              üßæ HIST√ìRICO DE TRANSA√á√ïES 
            -->
            <div id="transactions-page" class="page">
                <h2>Hist√≥rico de Transa√ß√µes</h2>
                <ul id="transactions-list">
                    <!-- Itens ser√£o preenchidos pelo JS -->
                </ul>
                <button type="button" class="btn btn-secondary btn-back-dashboard">Voltar ao Dashboard</button>
            </div>

            <!-- 
              üë§ PERFIL 
            -->
            <div id="profile-page" class="page">
                <h2>Meu Perfil</h2>
                <div class="info-box">
                    <p><strong>Nome:</strong> <span id="profile-info-nome"></span></p>
                    <p><strong>CPF:</strong> <span id="profile-info-cpf"></span></p>
                    <p><strong>Saldo:</strong> <span id="profile-info-saldo"></span></p>
                </div>
                
                <form id="profile-update-form">
                    <h3>Alterar Dados</h3>
                    <div class="form-group">
                        <label for="profile-nome">Alterar Nome</label>
                        <input type="text" id="profile-nome" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="profile-senha">Alterar Senha</label>
                        <input type="password" id="profile-senha" class="form-control" required minlength="4">
                    </div>
                    <button type="submit" class="btn">Salvar Altera√ß√µes</button>
                </form>

                <div class="danger-zone" style="margin-top: 2rem; border-top: 2px solid var(--cor-erro); padding-top: 1rem;">
                    <h3>Excluir Conta</h3>
                    <p>Esta a√ß√£o √© permanente e n√£o pode ser desfeita.</p>
                    <button id="btn-delete-account" class="btn btn-danger">Excluir Minha Conta Permanentemente</button>
                </div>
                
                <button type="button" class="btn btn-secondary btn-back-dashboard" style="margin-top: 1rem;">Voltar ao Dashboard</button>
            </div>

        </main>
    </div>

    <!-- 
      JavaScript (L√≥gica do App)
      Todo o JS est√° embutido neste arquivo HTML.
    -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- Constantes e Vari√°veis de Estado ---
            const dbKey = 'bancoFicticioUsuarios';
            const loggedInKey = 'bancoFicticioUsuarioLogado';
            let state = {
                usuarios: {},       // Armazena todos os usu√°rios
                usuarioLogado: null // Armazena o CPF do usu√°rio logado
            };

            // --- Seletores de Elementos (DOM) ---
            const pages = document.querySelectorAll('.page');
            const notificationBar = document.getElementById('notification-bar');

            // --- Fun√ß√µes Utilit√°rias ---

            /**
             * Mostra uma notifica√ß√£o na tela.
             * @param {string} message - A mensagem a ser exibida.
             * @param {string} type - 'success', 'error' ou 'info'.
             */
            function showNotification(message, type = 'success') {
                notificationBar.textContent = message;
                notificationBar.className = type; // Remove classes antigas e adiciona a nova
                notificationBar.classList.add('show');

                // Esconde a notifica√ß√£o ap√≥s 3 segundos
                setTimeout(() => {
                    notificationBar.classList.remove('show');
                }, 3000);
            }

            /**
             * Formata um n√∫mero para a moeda BRL (Reais).
             * @param {number} value - O valor num√©rico.
             * @returns {string} - O valor formatado (ex: "R$ 1.234,56").
             */
            function formatCurrency(value) {
                if (typeof value !== 'number') {
                    value = parseFloat(value) || 0;
                }
                return new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                }).format(value);
            }

            /**
             * Limpa e formata um CPF (remove caracteres n√£o num√©ricos).
             * @param {string} cpf - O CPF com ou sem formata√ß√£o.
             * @returns {string} - O CPF contendo apenas 11 d√≠gitos.
             */
            function formatCPF(cpf) {
                return cpf.replace(/\D/g, ''); // Remove tudo que n√£o for d√≠gito
            }

            /**
             * Exibe a p√°gina solicitada e oculta as outras.
             * @param {string} pageId - O ID da div da p√°gina (ex: 'home-page').
             */
            function showPage(pageId) {
                pages.forEach(page => {
                    page.classList.remove('active');
                });
                const activePage = document.getElementById(pageId);
                if (activePage) {
                    activePage.classList.add('active');
                } else {
                    console.error(`P√°gina n√£o encontrada: ${pageId}`);
                    document.getElementById('home-page').classList.add('active');
                }
            }

            // --- Fun√ß√µes de Persist√™ncia (localStorage) ---

            /**
             * Carrega os dados do localStorage para o estado do aplicativo.
             */
            function carregarDados() {
                const dadosUsuarios = localStorage.getItem(dbKey);
                const usuarioLogado = localStorage.getItem(loggedInKey);
                const theme = localStorage.getItem('theme');

                if (dadosUsuarios) {
                    state.usuarios = JSON.parse(dadosUsuarios);
                }
                if (usuarioLogado) {
                    state.usuarioLogado = usuarioLogado;
                }
                if (theme === 'dark') {
                    document.body.classList.add('dark-mode');
                }
            }

            /**
             * Salva o estado atual dos usu√°rios no localStorage.
             */
            function salvarUsuarios() {
                localStorage.setItem(dbKey, JSON.stringify(state.usuarios));
            }

            /**
             * Salva o CPF do usu√°rio logado no localStorage.
             * @param {string} cpf - O CPF do usu√°rio que fez login.
             */
            function salvarLogin(cpf) {
                state.usuarioLogado = cpf;
                localStorage.setItem(loggedInKey, cpf);
            }

            /**
             * Remove o usu√°rio logado do estado e do localStorage.
             */
            function fazerLogout() {
                state.usuarioLogado = null;
                localStorage.removeItem(loggedInKey);
            }

            /**
             * Adiciona uma transa√ß√£o ao hist√≥rico do usu√°rio e salva.
             * @param {string} cpf - CPF do usu√°rio.
             * @param {string} tipo - Descri√ß√£o da transa√ß√£o.
             * @param {number} valor - Valor (positivo para entradas, negativo para sa√≠das).
             * @param {number} saldoApos - O saldo resultante da conta.
             */
            function adicionarTransacao(cpf, tipo, valor, saldoApos) {
                const usuario = state.usuarios[cpf];
                if (!usuario) return;

                const novaTransacao = {
                    data: new Date().toLocaleString('pt-BR'),
                    tipo: tipo,
                    valor: valor,
                    saldoApos: saldoApos
                };
                
                // Adiciona no in√≠cio do array (mais recentes primeiro)
                usuario.transacoes.unshift(novaTransacao);
                salvarUsuarios();
            }

            // --- Fun√ß√µes de Atualiza√ß√£o de UI (Interface) ---

            /**
             * Atualiza as informa√ß√µes do Dashboard (nome, saldo).
             */
            function atualizarDashboard() {
                if (!state.usuarioLogado) return;
                const usuario = state.usuarios[state.usuarioLogado];
                if (!usuario) {
                    // Se o usu√°rio logado n√£o existir mais (ex: conta exclu√≠da), faz logout.
                    fazerLogout();
                    showPage('login-page');
                    showNotification('Erro ao carregar dados do usu√°rio. Fa√ßa login novamente.', 'error');
                    return;
                }
                document.getElementById('welcome-message').textContent = `Ol√°, ${usuario.nome}!`;
                document.getElementById('dashboard-saldo').textContent = formatCurrency(usuario.saldo);
            }

            /**
             * Carrega e exibe o hist√≥rico de transa√ß√µes na p√°gina de transa√ß√µes.
             */
            function atualizarPaginaTransacoes() {
                if (!state.usuarioLogado) return;
                const usuario = state.usuarios[state.usuarioLogado];
                const listElement = document.getElementById('transactions-list');
                listElement.innerHTML = ''; // Limpa a lista

                if (usuario.transacoes.length === 0) {
                    listElement.innerHTML = '<li>Nenhuma transa√ß√£o encontrada.</li>';
                    return;
                }

                usuario.transacoes.forEach(t => {
                    const li = document.createElement('li');
                    const valorClasse = t.valor > 0 ? 'valor-positivo' : (t.valor < 0 ? 'valor-negativo' : '');
                    const valorFormatado = formatCurrency(t.valor);
                    
                    li.innerHTML = `
                        <div class="transacao-info">
                            <span class="transacao-tipo">${t.tipo}</span>
                            <span class="transacao-data">${t.data}</span>
                        </div>
                        <div class="transacao-valor">
                            <span class="${valorClasse}">${valorFormatado}</span>
                            <br>
                            <span class="transacao-data">Saldo: ${formatCurrency(t.saldoApos)}</span>
                        </div>
                    `;
                    listElement.appendChild(li);
                });
            }
            
            /**
             * Carrega os dados do usu√°rio na p√°gina de perfil.
             */
            function atualizarPaginaPerfil() {
                if (!state.usuarioLogado) return;
                const usuario = state.usuarios[state.usuarioLogado];
                
                // Info Box
                document.getElementById('profile-info-nome').textContent = usuario.nome;
                document.getElementById('profile-info-cpf').textContent = state.usuarioLogado; // CPF n√£o deve ser formatado aqui
                document.getElementById('profile-info-saldo').textContent = formatCurrency(usuario.saldo);

                // Formul√°rio de Altera√ß√£o
                document.getElementById('profile-nome').value = usuario.nome;
                document.getElementById('profile-senha').value = usuario.senha;
            }


            // --- Manipuladores de Eventos (L√≥gica Principal) ---

            /**
             * [criarConta]
             * Manipula o envio do formul√°rio de cria√ß√£o de conta.
             */
            function handleCriarConta(e) {
                e.preventDefault();
                const nome = document.getElementById('create-nome').value.trim();
                const cpf = formatCPF(document.getElementById('create-cpf').value);
                const senha = document.getElementById('create-senha').value;

                // Valida√ß√µes
                if (cpf.length !== 11) {
                    showNotification('CPF inv√°lido. Deve conter 11 d√≠gitos.', 'error');
                    return;
                }
                if (state.usuarios[cpf]) {
                    showNotification('Este CPF j√° est√° cadastrado.', 'error');
                    return;
                }
                if (senha.length < 4) {
                    showNotification('A senha deve ter no m√≠nimo 4 caracteres.', 'error');
                    return;
                }

                // Cria o usu√°rio
                state.usuarios[cpf] = {
                    nome: nome,
                    senha: senha,
                    saldo: 0,
                    transacoes: []
                };

                salvarUsuarios();
                showNotification('Conta criada com sucesso! Fa√ßa o login.', 'success');
                e.target.reset(); // Limpa o formul√°rio
                showPage('login-page');
            }

            /**
             * [login]
             * Manipula o envio do formul√°rio de login.
             */
            function handleLogin(e) {
                e.preventDefault();
                const cpf = formatCPF(document.getElementById('login-cpf').value);
                const senha = document.getElementById('login-senha').value;

                const usuario = state.usuarios[cpf];

                // Valida√ß√µes
                if (!usuario) {
                    showNotification('CPF n√£o encontrado.', 'error');
                    return;
                }
                if (usuario.senha !== senha) {
                    showNotification('Senha incorreta.', 'error');
                    return;
                }

                // Sucesso
                salvarLogin(cpf);
                atualizarDashboard();
                showPage('dashboard-page');
                e.target.reset(); // Limpa o formul√°rio
            }

            /**
             * [depositar]
             * Manipula o envio do formul√°rio de dep√≥sito.
             */
            function handleDepositar(e) {
                e.preventDefault();
                const amount = parseFloat(document.getElementById('deposit-amount').value);
                
                if (isNaN(amount) || amount <= 0) {
                    showNotification('Valor de dep√≥sito inv√°lido.', 'error');
                    return;
                }

                const usuario = state.usuarios[state.usuarioLogado];
                usuario.saldo += amount;
                
                adicionarTransacao(state.usuarioLogado, 'Dep√≥sito', amount, usuario.saldo);
                
                atualizarDashboard();
                showNotification(`Dep√≥sito de ${formatCurrency(amount)} realizado!`, 'success');
                e.target.reset();
                showPage('dashboard-page');
            }

            /**
             * [transferirPix]
             * Manipula o envio do formul√°rio de transfer√™ncia.
             */
            function handleTransferirPix(e) {
                e.preventDefault();
                const cpfDestino = formatCPF(document.getElementById('transfer-cpf').value);
                const amount = parseFloat(document.getElementById('transfer-amount').value);
                
                const remetente = state.usuarios[state.usuarioLogado];
                const destinatario = state.usuarios[cpfDestino];

                // Valida√ß√µes
                if (isNaN(amount) || amount <= 0) {
                    showNotification('Valor de transfer√™ncia inv√°lido.', 'error');
                    return;
                }
                if (amount > remetente.saldo) {
                    showNotification('Saldo insuficiente para esta transfer√™ncia.', 'error');
                    return;
                }
                if (!destinatario) {
                    showNotification('CPF do destinat√°rio n√£o encontrado.', 'error');
                    return;
                }
                if (cpfDestino === state.usuarioLogado) {
                    showNotification('Voc√™ n√£o pode transferir para si mesmo.', 'error');
                    return;
                }

                // Executa a transa√ß√£o
                remetente.saldo -= amount;
                destinatario.saldo += amount;

                // Adiciona aos hist√≥ricos
                adicionarTransacao(state.usuarioLogado, `Pix Enviado para ${destinatario.nome}`, -amount, remetente.saldo);
                adicionarTransacao(cpfDestino, `Pix Recebido de ${remetente.nome}`, amount, destinatario.saldo);

                // (salvarUsuarios() √© chamado dentro de adicionarTransacao)

                atualizarDashboard();
                showNotification(`Transfer√™ncia de ${formatCurrency(amount)} enviada para ${destinatario.nome}.`, 'success');
                e.target.reset();
                showPage('dashboard-page');
            }

            /**
             * [investir]
             * Manipula o envio do formul√°rio de investimento.
             */
            function handleInvestir(e) {
                e.preventDefault();
                const tipo = document.getElementById('invest-type').value;
                const amount = parseFloat(document.getElementById('invest-amount').value);
                
                const usuario = state.usuarios[state.usuarioLogado];
                
                // Valida√ß√µes
                if (isNaN(amount) || amount <= 0) {
                    showNotification('Valor de investimento inv√°lido.', 'error');
                    return;
                }
                 if (amount > usuario.saldo) {
                    showNotification('Saldo insuficiente para este investimento.', 'error');
                    return;
                }

                // Executa o investimento
                usuario.saldo -= amount;
                const tipoDescricao = tipo.toUpperCase();
                const rendimento = (tipo === 'cdb') ? amount * 0.10 : amount * 0.08;
                
                adicionarTransacao(state.usuarioLogado, `Aplica√ß√£o ${tipoDescricao}`, -amount, usuario.saldo);

                atualizarDashboard();
                showNotification(`Investimento de ${formatCurrency(amount)} em ${tipoDescricao} aplicado.`, 'success');
                showNotification(`Rendimento estimado: ${formatCurrency(rendimento)}/ano.`, 'info');
                e.target.reset();
                showPage('dashboard-page');
            }

            /**
             * [alterarPerfil]
             * Manipula o envio do formul√°rio de altera√ß√£o de perfil.
             */
            function handleAlterarPerfil(e) {
                e.preventDefault();
                const novoNome = document.getElementById('profile-nome').value.trim();
                const novaSenha = document.getElementById('profile-senha').value;

                if (novaSenha.length < 4) {
                    showNotification('A nova senha deve ter no m√≠nimo 4 caracteres.', 'error');
                    return;
                }
                if (!novoNome) {
                    showNotification('O nome n√£o pode ficar em branco.', 'error');
                    return;
                }

                const usuario = state.usuarios[state.usuarioLogado];
                usuario.nome = novoNome;
                usuario.senha = novaSenha;

                salvarUsuarios();
                atualizarDashboard(); // Atualiza o "Ol√°, [Nome]"
                showNotification('Perfil atualizado com sucesso!', 'success');
                showPage('dashboard-page');
            }

            /**
             * [excluirConta]
             * Manipula o clique no bot√£o de excluir conta.
             */
            function handleExcluirConta() {
                // Em um app real, usar√≠amos um modal.
                // Como 'confirm' n√£o √© permitido, faremos uma valida√ß√£o simples.
                const confirmacao = prompt("Esta a√ß√£o √© irrevers√≠vel. Para confirmar, digite seu CPF:");
                
                if (confirmacao === null) return; // Usu√°rio cancelou

                if (formatCPF(confirmacao) !== state.usuarioLogado) {
                    showNotification('CPF incorreto. Exclus√£o cancelada.', 'error');
                    return;
                }

                // Exclui o usu√°rio
                delete state.usuarios[state.usuarioLogado];
                salvarUsuarios();
                fazerLogout();

                showNotification('Conta exclu√≠da com sucesso.', 'info');
                showPage('home-page');
            }

            /**
             * Manipula o clique no bot√£o de logout.
             */
            function handleLogout() {
                fazerLogout();
                showNotification('Voc√™ saiu da sua conta.', 'info');
                showPage('home-page');
            }

            /**
             * [Configura√ß√µes] Alterna o tema.
             */
            function handleToggleTheme() {
                document.body.classList.toggle('dark-mode');
                const isDark = document.body.classList.contains('dark-mode');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
            }

            /**
             * [Configura√ß√µes] Limpa todos os dados do localStorage.
             */
            function handleClearData() {
                const confirmacao = prompt("Tem certeza? Isso apagar√° TODOS os dados de TODOS os usu√°rios. Digite 'LIMPAR':");
                if (confirmacao === 'LIMPAR') {
                    localStorage.clear();
                    state.usuarios = {};
                    state.usuarioLogado = null;
                    document.body.classList.remove('dark-mode');
                    showNotification('Todos os dados foram limpos.', 'info');
                    showPage('home-page');
                } else {
                    showNotification('Limpeza cancelada.', 'error');
                }
            }


            // --- Inicializa√ß√£o e Navega√ß√£o ---
            
            /**
             * Adiciona todos os listeners de eventos da aplica√ß√£o.
             */
            function adicionarListenersDeEventos() {
                // Navega√ß√£o por Bot√µes
                document.getElementById('btn-goto-login').addEventListener('click', () => showPage('login-page'));
                document.getElementById('btn-goto-create-account').addEventListener('click', () => showPage('create-account-page'));
                
                // Bot√µes de "Voltar"
                document.querySelectorAll('.btn-back-home').forEach(btn => btn.addEventListener('click', () => showPage('home-page')));
                document.querySelectorAll('.btn-back-dashboard').forEach(btn => {
                    btn.addEventListener('click', () => {
                        atualizarDashboard(); // Garante que o saldo esteja atualizado ao voltar
                        showPage('dashboard-page');
                    });
                });

                // Navega√ß√£o do Dashboard
                document.getElementById('btn-goto-deposit').addEventListener('click', () => showPage('deposit-page'));
                document.getElementById('btn-goto-transfer').addEventListener('click', () => showPage('transfer-page'));
                document.getElementById('btn-goto-invest').addEventListener('click', () => showPage('invest-page'));
                document.getElementById('btn-goto-transactions').addEventListener('click', () => {
                    atualizarPaginaTransacoes();
                    showPage('transactions-page');
                });
                document.getElementById('btn-goto-profile').addEventListener('click', () => {
                    atualizarPaginaPerfil();
                    showPage('profile-page');
                });
                document.getElementById('btn-logout').addEventListener('click', handleLogout);

                // Formul√°rios
                document.getElementById('create-account-form').addEventListener('submit', handleCriarConta);
                document.getElementById('login-form').addEventListener('submit', handleLogin);
                document.getElementById('deposit-form').addEventListener('submit', handleDepositar);
                document.getElementById('transfer-form').addEventListener('submit', handleTransferirPix);
                document.getElementById('invest-form').addEventListener('submit', handleInvestir);
                document.getElementById('profile-update-form').addEventListener('submit', handleAlterarPerfil);
                
                // Bot√µes de A√ß√£o Especiais
                document.getElementById('btn-delete-account').addEventListener('click', handleExcluirConta);
                document.getElementById('btn-toggle-theme').addEventListener('click', handleToggleTheme);
                document.getElementById('btn-clear-data').addEventListener('click', handleClearData);
            }

            /**
             * Fun√ß√£o principal de inicializa√ß√£o do aplicativo.
             */
            function initApp() {
                carregarDados();
                adicionarListenersDeEventos();

                // Roteamento inicial:
                // Se o usu√°rio est√° logado, vai para o dashboard.
                // Sen√£o, vai para a home.
                if (state.usuarioLogado && state.usuarios[state.usuarioLogado]) {
                    atualizarDashboard();
                    showPage('dashboard-page');
                } else {
                    fazerLogout(); // Limpa login inv√°lido, se houver
                    showPage('home-page');
                }
            }

            // Inicia o aplicativo
            initApp();
        });
    </script>
</body>
</html>